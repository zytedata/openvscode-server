<!-- Copyright (c) Gitpod. All rights reserved.' -->
<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
	<title>Gitpod: Redirect</title>
	<style type="text/css">
		html {
			height: 100%;
		}

		body {
			box-sizing: border-box;
			min-height: 100%;
			margin: 0;
			padding: 15px 30px;
			display: flex;
			flex-direction: column;
			color: white;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", system-ui, "Ubuntu", "Droid Sans", sans-serif;
			background-color: #2C2C32;
		}

		.message-container {
			flex-grow: 1;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 30px;
		}

		.message {
			font-weight: 700;
			font-size: 2.0rem;
		}

	</style>
</head>

<body>
	<div class="message-container">
		<div class="message">
			You can close this page now.
		</div>
	</div>

	<script>
		(function () {
			function decode(value) {
				return value === null ? null : decodeURIComponent(value);
			}

			const url = new URL(window.location.href);
			const params = url.searchParams;
			const id = decode(params.get('vscode-reqid'));
			const scheme = decode(params.get('vscode-scheme'));
			const authority = decode(params.get('vscode-authority'));

			if (!id) {
				throw new Error('Missing id');
			} else if (!scheme) {
				throw new Error('Missing scheme');
			} else if (!authority) {
				throw new Error('Missing authority');
			}

			const path = decode(params.get('vscode-path'));
			const query = decode(params.get('vscode-query'));
			const fragment = decode(params.get('vscode-fragment'));

			params.delete('vscode-reqid');
			params.delete('vscode-scheme');
			params.delete('vscode-authority');
			params.delete('vscode-path');
			params.delete('vscode-query');
			params.delete('vscode-fragment');

			let uri = { scheme, authority };

			if (path) {
				uri.path = path;
			}

			if (query) {
				const originalParams = new URLSearchParams(query);
				originalParams.forEach((value, key) => params.set(key, value));
			}

			const resultQuery = params.toString();
			if (resultQuery) {
				uri.query = resultQuery;
			}

			if (url.hash) {
				uri.fragment = url.hash.replace(/^#/, '');
			} else if (fragment) {
				uri.fragment = fragment;
			}

			window.localStorage.setItem(`vscode-web.url-callbacks[${id}]`, JSON.stringify(uri));
		})();
	</script>
</body>

</html>
